# AGENTS.md

Instructions for AI agents (Claude Code, GitHub Copilot, etc.) working in this repository.

## Quick Start

```bash
# No build step - just open index.html in browser
python -m http.server 8000
# Then visit http://localhost:8000
```

---

## Agent Entry Points

### Bug Fixes
1. Read `CLAUDE.md` for architecture overview
2. This is a single-file app - all code is in `index.html`
3. Look for section comments (`/* ========== SECTION ========== */` in CSS, `// ========== SECTION ==========` in JS)
4. Test the fix by opening index.html in a browser and verifying the behavior

### Feature Additions
1. Determine which layer needs changes:
   - **CSS**: Lines 19-1043 (organized by component/section)
   - **HTML**: Lines 1046-1170 (semantic markup with ARIA)
   - **JavaScript**: Lines 1172-1899 (organized by functionality)
2. Follow existing patterns - check similar features for reference
3. Maintain dark theme consistency using CSS variables from `:root`
4. Ensure accessibility (ARIA labels, keyboard support)
5. Test on both desktop and mobile viewports

### Documentation Updates
1. Update `README.md` for user-facing changes
2. Update `CLAUDE.md` for structural/architectural changes
3. DocFlow auto-generates `docs/generated/` - don't edit those manually

---

## Code Organization

### CSS Sections (in order)
```
:root (CSS variables)
Skip Link / Screen reader
Header
Stats display
Buttons
Loading Overlay
Toast Notifications
Drop Zone
Split Pane Layout
Diff Viewer
Content Area
PDF Container
GitHub-style Markdown
Code copy button
Mermaid diagrams
HTML iframe
Keyboard shortcut hint
Responsive Styles (@media)
Print styles
```

### JavaScript Sections (in order)
```
INITIALIZATION (libraries)
STATE (global variables)
DOM ELEMENTS
STATS CALCULATION
TOAST NOTIFICATIONS
RESPONSIVE PDF SCALING
DRAG AND DROP
KEYBOARD SHORTCUTS
HEADER SCROLL SHADOW
AUTO-HIDE SHORTCUT HINT
SPLIT PANE DIVIDER
FILE LOADING
DIFF VIEW
VIEW MANAGEMENT
MARKDOWN LOADING
HTML LOADING
JSON LOADING
PDF LOADING
UTILITIES
URL PARAMETERS
```

---

## Do's and Don'ts

### Do
- Use CSS variables for colors (e.g., `var(--text-primary)`, `var(--accent)`)
- Add ARIA labels to interactive elements
- Support keyboard navigation
- Test file drag-and-drop, click-to-open, and URL param loading
- Keep the single-file architecture - no external JS/CSS files
- Escape user content with `escapeHtml()` before inserting into DOM
- Follow existing naming conventions (camelCase for JS, kebab-case for CSS)

### Don't
- Modify CI workflows unless explicitly asked
- Add npm dependencies - use CDN for any new libraries
- Break the single-file structure
- Remove accessibility features (skip links, ARIA, keyboard support)
- Add server-side requirements - this must work statically
- Commit sensitive files or test data

---

## Testing Requirements

Before any PR:
1. Manual test all file types: Markdown, HTML, PDF, JSON, XML, CSV, TXT
2. Test the Compare feature (load text file, click Compare, load second file)
3. Test URL parameters: `?file=url` and `?files=url1,url2`
4. Test keyboard shortcuts: Ctrl+O, Esc, ←/→ for PDF
5. Test responsive: resize to mobile width, verify usability
6. Verify stats display shows for text files
7. CI must pass (DocFlow, security scans)

---

## File Ownership

| Files | Modify Freely | Requires Review |
|-------|---------------|-----------------|
| `CLAUDE.md`, `.github/AGENTS.md` | Yes | No |
| `README.md` | Yes | No |
| `index.html` | Yes | No (but test thoroughly) |
| `.github/workflows/*` | No | Yes - CI/CD |
| `docs/generated/*` | No | Auto-generated by DocFlow |

---

## Known Limitations

- **Single-threaded**: Large file processing may block UI briefly
- **No file system access**: Browser security prevents direct file opening; requires drag-drop or file picker
- **CORS for URL loading**: Remote files must have permissive CORS headers
- **No persistence**: No localStorage/sessionStorage for preferences or recent files
- **PDF limitations**: Canvas-based rendering means no text selection in PDFs

---

## Adding New File Type Support

1. **Add extension** to `supportedExts` array:
   ```javascript
   const supportedExts = ['md', 'markdown', 'html', 'htm', 'pdf', 'txt', 'json', 'xml', 'csv', 'NEW'];
   ```

2. **If text-based**, add to `textExts` for comparison support:
   ```javascript
   const textExts = ['md', 'markdown', 'txt', 'json', 'xml', 'csv', 'NEW'];
   ```

3. **Add format badge** in HTML:
   ```html
   <li class="format-badge">NEW</li>
   ```

4. **Update file input accept**:
   ```html
   <input type="file" id="file-input" accept=".md,...,.NEW">
   ```

5. **Add routing** in `loadFile()`:
   ```javascript
   } else if (ext === 'new') {
       loadNEW(file);
   }
   ```

6. **Create loader function**:
   ```javascript
   async function loadNEW(file) {
       try {
           const text = await file.text();
           fileManager.addFile(file, text, 'new');
           // Process and render...
           updateStats(text);
           // Show content...
       } catch (e) {
           showLoading(false);
           showToast('Failed to load file: ' + e.message, 'error');
       }
   }
   ```

---

## Commit Message Format

```
<type>: <short description>

Types: fix, feat, docs, test, chore, refactor
```

Examples:
- `fix: handle edge case in PDF zoom`
- `feat: add YAML file support`
- `docs: update installation instructions`
- `refactor: simplify diff rendering logic`

